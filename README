Grapeboard is a development board based on NXP LS1012A processor.

# Get sources

To download required yocto layers pull all git submodules recursively:
$ git submodules init
$ git submodules update --recursive --remote

# Build

To build image first source the environment script:
$ source grapeboard-env

Then build image either for SD card/USB stick/SSD driver with:
$ bitbake scalys-base-image

Or the version for deploy on the internal QSPI flesh memory:
$ bitbake scalys-base-image-qspi

All the built images will be availabe at <BSP>/build/tmp/deploy/images/grapeboard


# Deploy

## U-Boot

There are two u-boot images generated by the yocto build:

- u-boot.bin-pcie
- u-boot.bin-sata

They differ in the way bootloader configures m.2 slot. Depending on the required
configuration take the needed image.

1. Put the generated u-boot image in the root of the SD card.
2. Rename it as a u-boot-with-pbl.bin
3. Boot the grapeboard and stop the boot process at the bootloader stage.
4. Run the u-boot update scrip:
=> run update_mmc_uboot_qspi_nor

## PFE firmware

1. Place the pfe firmware engine-pfe-bin/pfe_fw_sbl.itb in the SD card root
2. Boot the grapeboard and stop the boot process at the bootloader stage.
3. Run the pfe update scrip:
=> run update_mmc_pfe_qspi_nor

## PPA firmware

1. Place the ppa firmware ppa.itb in the SD card root
2. Boot the grapeboard and stop the boot process at the bootloader stage.
3. Run the ppa update scrip:
=> run update_mmc_ppa_qspi_nor

## SD card root

1. Format SD card into a single ext4 partition
2. Unpack contents of the generated scalys-base-image-grapeboard.tar.gz to the SD card

## QSPI root

1. Put the ubi image file scalys-base-image-qspi-grapeboard.ubi on the SD card.
2. Boot the Grapeboard from SD card
3. Format root partition with the selected image:
$ ubiformat /dev/mtd4 -f /scalys-base-image-qspi-grapeboard.ubi

# Boot

Note that to boot from QSPI memory SD card should be
